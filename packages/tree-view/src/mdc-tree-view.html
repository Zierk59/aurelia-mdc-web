<template class="mdc-tree-view">
  <require from="./mdc-tree-node"></require>
  <require from="./node-filter"></require>
  <ul class="mdc-tree-view__list">
    <li repeat.for="$node of nodes | nodeFilter:filter" class="mdc-tree-view__list-item">
      <let $tree.bind="element"></let>
      <let $tree-vm.bind="$parent"></let>
      <div class="mdc-tree-view__node ${$node.selected ? 'mdc-tree-view__node--selected' : ''}"
        click.trigger="nodeClicked($node)" mdc-ripple="no-class.bind: true;">
        <div class="mdc-tree-view__node__ripple"></div>
        <let filtered-children.bind="$node.children | nodeFilter:filter"></let>
        <button as-element="mdc-icon-button" if.bind="filteredChildren.length" type="fab" size="small"
          class="mdc-tree-view__expander" on.bind="$node.expanded">
          <mdc-icon-button-icon class="material-icons">chevron_right</mdc-icon-button-icon>
          <mdc-icon-button-icon class="material-icons" on>expand_more</mdc-icon-button-icon>
        </button>
        <div else class="mdc-tree-view__leaf-padding"></div>
        <au-compose view.bind="nodeTemplate" model.bind="$node" class="mdc-tree-node"></au-compose>
      </div>
      <mdc-promisify-reference if.bind="$node.children" reference.bind="treeView"
        promise-ref.bind="$node.childTreeViewPromise">
      </mdc-promisify-reference>
      <mdc-tree-view if.bind="filteredChildren.length && $node.expanded" nodes.bind="filteredChildren"
        root-binding-context.bind="rootBindingContext" view-model.ref="treeView"
        mdctree:node-selected.trigger="childNodeSelected($event.detail.node)" node-template.bind="nodeTemplate">
      </mdc-tree-view>
    </li>
  </ul>
  <span repeat.for="o of onTest">${o}</span>
</template>
